function ARTSTATION(e){var o=!1,n=30,t=50,i="filepost.artstation.org.uk/ASSETS",a=[],r=[],l=[],c=[],s=[0,0],d=[0,0],u=null,T=new THREE.Group;T.name="ARTSTATION_WorldViewMap";var m=[{x:0,y:0}],f=0,v=0,p=[0,0],w=0,h=null,I=0,E=1,g=2,A=null,R=!0,O=0,M=1,C=2,_=3,y=4,S=5,N=6,V=18,k=17,x=14,L=3,P=1.3,D=0,b=[["https://",".wikimedia.org/osm-intl","png",["maps"]],["https://",".tile.openstreetmap.org","png",["a","b","c","d"]],["https://",".tile.opentopomap.org","png",["a","b","c","d"]],["http://",".tile.stamen.com/watercolor","jpg",["a","b","c","d"]],["https://stamen-tiles-d.",".ssl.fastly.net/toner","png",["a"]]],H=2,z=2;window.viewer=new Potree.Viewer(document.getElementById("potree_render_area"),{useDefaultRenderLoop:!1});var W=new MobileDetect(window.navigator.userAgent),B=5e5,F=100,U=!0;function G(e,o){var n="default",t=100;e.is_pointcloud&&(n=e.filename,t=300),Potree.loadPointCloud("http://"+i+"/POINTCLOUDS/"+n+"/cloud.js",n,function(i){var a=i.pointcloud,l=a.material,c=e.z_offset;if(void 0==c&&(c=0),e.is_pointcloud)a.position.z=c;else{var s=ConvertToUTM(e.gps[0],e.gps[1]);a.position.set(s[0],s[1],c)}viewer.scene.addPointCloud(a),l.pointColorType=Potree.PointColorType.RGB,l.size=1,l.pointSizeType=Potree.PointSizeType.ADAPTIVE,l.shape=Potree.PointShape.CIRCLE,viewer.fitToScreen();var d=new THREE.CircleGeometry(t,32),u=new THREE.MeshBasicMaterial({color:9109504}),m=new THREE.Mesh(d,u);m.name="ARTSTATION_LocationMarker";var p=a.uuid,w=null,h=null,I=[];if(e.is_pointcloud){a.updateMatrixWorld();var E=a.pcoGeometry.tightBoundingBox.clone();E.applyMatrix4(a.matrixWorld),w=E.getCenter(),m.position.set(w.x,w.y,10),h=ConvertToCoordinates(w.x,w.y),I=[!1,!1]}else m.position.set(s[0],s[1],10),p=null,w=new THREE.Vector3(s[0],s[1],c),h=e.gps,I=[!1];viewer.scene.scene.add(m);var g={Name:e.name,FileName:n,UUID:p,Z_Offset:e.z_offset,Position:w,BasePosition:a.position,LocationGPS:h,LocationID:e.location_id,MapLoaded:I,Marker:m},A=r.push(g);!function(e){if(null!=r[e].UUID){var o=Re(r[e].LocationGPS,V,b[z],e);o.name="ARTSTATION_EnvViewMap_"+r[e].UUID,o.visible=!1,viewer.scene.scene.add(o)}T.add(Re(r[e].LocationGPS,x,b[H],e));for(var n=0;n<viewer.scene.scene.children.length;n++)"ARTSTATION_WorldViewMap"==viewer.scene.scene.children[n].name&&viewer.scene.scene.remove(viewer.scene.scene.children[n]);viewer.scene.scene.add(T)}(A-1);var R=new Potree.Annotation({position:w,title:e.name});e.is_pointcloud?R.addEventListener("click",function(e){viewer.getControls(viewer.scene.view.navigationMode).zoomToLocation({x:0,y:0},!0,1600,!0,function(){Z()},{pointcloud_origin:a.position,pointcloud_center:center}),$(".annotation").fadeOut(600,function(){$(".annotation").hide()}),pe(S)}):R.addEventListener("click",function(e){j(A-1),$("#ARTSTATION_ControlPanel").modal("show")}),viewer.scene.annotations.add(R),Potree.measureTimings=!0;var O="+proj=utm +zone=30 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",M=proj4.defs("WGS84");window.toMap=proj4(O,M),window.toScene=proj4(M,O);var C=viewer.getBoundingBox();proj4(O,M,C.min.toArray()),proj4(O,M,C.max.toArray());me((v+=1)/f*100,0),o(e,A-1)})}function Z(){if(ee.didClickEnvironment){for(var e=0;e<r.length;e++)ee.clickedEnvironmentUUID==r[e].UUID&&(h=r[e],he(!1),j(e),$(".ARTSTATION_LocationTitle").text(r[e].Name));u=viewer.scene.view.radius,ee.worldViewCameraConfig=!1,fe(E,!0),ge(!0);for(e=0;e<a.length;e++)if(r[a[e].LocationDataIndex].UUID==ee.clickedEnvironmentUUID){var o=ConvertToUTM(a[e].ImportedTrackData[0][0],a[e].ImportedTrackData[0][1]),n=new THREE.Vector3(o[0]+a[e].X_Offset,o[1]+a[e].Y_Offset,parseFloat(a[e].ImportedTrackData[0][3])+r[a[e].LocationDataIndex].Z_Offset-a[e].Z_Offset);a[e].VideoMarker.position.x=n.x,a[e].VideoMarker.position.y=n.y,a[e].VideoMarker.position.z=n.z,a[e].VideoMarker.visible=!0,new TWEEN.Tween(a[e].VideoMarker.material).to({opacity:1},500).start()}}}function q(e,o,n,t){for(var i="",a=0;a<t.length;a++)i+="<li>"+t[a]+"</li>";var c={Title:o,Subtitle:n,List:i},s=l.push(c);s-=1,r[e].LocationInfoIndex=s}function j(e){$(".modal-title").html(l[r[e].LocationInfoIndex].Title),$(".modal-body").html("<b>"+l[r[e].LocationInfoIndex].Subtitle+"</b><br><br>"+l[r[e].LocationInfoIndex].List)}function K(e,o,l,c,s,d){var u=document.createElement("video");u.src="http://"+i+"/VIDEOS/"+r[e].FileName+"/"+o,null==W.mobile()?u.src+=".mp4":u.src+="_mobile.mp4",u.id=r[e].FileName+"_"+o,u.autoplay=!1,u.loop=!1,u.volume=1,u.muted=!1,u.width=window.innerWidth,u.crossOrigin="anonymous",document.body.appendChild(u);var T=new THREE.Group;T.name="ARTSTATION_VideoTrackGroup",viewer.scene.scene.add(T);var m=new THREE.PlaneGeometry(20,12,1,1),f=document.getElementById(r[e].FileName+"_"+o),v=new THREE.VideoTexture(f);v.minFilter=THREE.LinearFilter,v.magFilter=THREE.LinearFilter,v.format=THREE.RGBFormat;var p=new THREE.MeshBasicMaterial({color:16777215,map:v,transparent:!0,opacity:0}),w=new THREE.Mesh(m,p);w.material.side=THREE.DoubleSide,w.name="ARTSTATION_VideoPlane",w.position.x=0,w.position.y=0,w.position.z=0,w.rotation.y=Math.PI/2,w.rotation.z=Math.PI/2,w.visible=!1,T.add(w);var h=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,1/0);h.position.x=0,h.position.y=0,null==W.mobile()?h.position.z=n:h.position.z=t,h.name="ARTSTATION_TrackingCamera",w.add(h);var I=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,1/0);h.name="ARTSTATION_TransitionCamera",viewer.scene.scene.add(I),I.fov=viewer.scene.getActiveCamera().fov,h.fov=viewer.scene.getActiveCamera().fov;var E=(new THREE.TextureLoader).load("http://"+i+"/VIDEOS/"+r[e].FileName+"/"+o+".png");E.crossOrigin="anonymous";var R=new THREE.SpriteMaterial({map:E,color:16777215,transparent:!0,opacity:0}),O=new THREE.Sprite(R);O.scale.set(17,11,0),O.name="ARTSTATION_VideoMarker",viewer.scene.scene.add(O);var M=[],C="API/gps_parser.php?location="+r[e].FileName+"&video="+o;$.getJSON(C,function(e){$.each(e,function(e,o){M.push(o)})});var _,y,S,N,V,k,x={Name:o,ElementID:r[e].FileName+"_"+o,LocationDataIndex:e,VideoMesh:w,ImportedTrackData:M,LockCamera:!1,VideoMarker:O,VideoCamera:h,VideoParent:T,X_Offset:c,Y_Offset:s,Z_Offset:d,TransitionCamera:I,VideoTitle:l,LocationInfoIndex:null},L=a.push(x);_=L-=1,y=!1,S=0,N=0,V=0,k=viewer.getControls(viewer.scene.view.navigationMode),$("#"+a[_].ElementID).on("timeupdate",function(e){var o=Math.floor(this.currentTime-60*Math.floor(this.currentTime/60)),n=Math.floor(this.duration-60*Math.floor(this.duration/60));1==o.toString().length&&(o="0"+o),1==n.toString().length&&(n="0"+n),$(".ARTSTATION_CurrentVideoTime").text(Math.floor(this.currentTime/60)+":"+o),$(".ARTSTATION_FullVideoTime").text(Math.floor(this.duration/60)+":"+n),$(".ARTSTATION_VideoProgressBar").width(this.currentTime/this.duration*100+"%"),0==Math.floor(this.currentTime)&&(S=0,N=0,V=0);var t=!1,i=0,l=0;try{"CSV"==a[_].ImportedTrackData[S][11]&&(l=500)}catch(e){}for(var c=0;c<20;c++)try{if(!(Math.floor(1e3*this.currentTime+l)>a[_].ImportedTrackData[S+c][4]-a[_].ImportedTrackData[0][4]))break;t=!0,i=c}catch(e){t=!1}if(t&&A==g){S+=i,V=1e3*this.currentTime;var s=ConvertToUTM(a[_].ImportedTrackData[S][0],a[_].ImportedTrackData[S][1]),d=new THREE.Vector3(s[0]+a[_].X_Offset,s[1]+a[_].Y_Offset,parseFloat(a[_].ImportedTrackData[S][3])+r[a[_].LocationDataIndex].Z_Offset-a[_].Z_Offset),u=new THREE.Euler(a[_].ImportedTrackData[S][8]*Math.PI/180,a[_].ImportedTrackData[S][10]*Math.PI/180,a[_].ImportedTrackData[S][9]*Math.PI/180,"XYZ"),T=V-N;(a[_].VideoParent.rotation.z-u.y<-3||a[_].VideoParent.rotation.z-u.y>3)&&S!=i&&(u.y=-1*a[_].VideoParent.rotation.z,T=0);var m=new TWEEN.Tween(a[_].VideoParent.position).to(d,T),f=new TWEEN.Tween(a[_].VideoMesh.rotation).to({x:u.x,y:0,z:0},T),v=new TWEEN.Tween(a[_].VideoParent.rotation).to({x:0,y:0,z:u.y},T);m.onStart(function(){f.start(),v.start(),k.isTransitioning=!0,y=!0}),m.onComplete(function(){!a[_].LockCamera&&y&&(Y(_),k.isTransitioning=!1,y=!1,TRACKING_CAMERA_OBJECT=null,TRACKING_CAMERA_IS_ENABLED=!1)}),m.start(),S++,N=1e3*this.currentTime}}),$("#"+a[_].ElementID).on("ended",function(){a[_].LockCamera&&y&&(k.isTransitioning=!1,J())})}function X(e,o){var n=document.getElementById(a[e].ElementID);o?(n.currentTime=0,n.play(),$(".ARTSTATION_VideoTitle").text(a[e].VideoTitle),Ie(e,!0,function(){a[e].LockCamera=!0,TRACKING_CAMERA_OBJECT=a[e].VideoCamera,TRACKING_CAMERA_IS_ENABLED=!0,fe(g,!0)})):n.play()}function Y(e){var o=document.getElementById(a[e].ElementID);o.style.display="none",o.pause(),o.currentTime=0,a[e].VideoMesh.visible=!1,we(!0,!1,500),null==W.mobile()?a[e].VideoCamera.position.z=n:a[e].VideoCamera.position.z=t,d=[0,0]}function J(){for(var e=0;e<a.length;e++)if(1==a[e].LockCamera){var o=e;Ie(e,!1,function(){X(o,!1);var e=viewer.getControls(viewer.scene.view.navigationMode);fe(E,!0),e.isTransitioning=!1,a[o].LockCamera=!1,TRACKING_CAMERA_OBJECT=null,TRACKING_CAMERA_IS_ENABLED=!1,Y(o)})}}null!=W.mobile()&&(F=200,U=!1,B=1e5),"A"!=W.mobileGrade()&&(F=300,U=!1,B=5e4),viewer.setFOV(60),viewer.setPointBudget(B),viewer.setEDLEnabled(!1),viewer.loadSettingsFromURL(),viewer.useHQ=U,viewer.setMinNodeSize(F),null!=W.mobile()?$(".ARTSTATION_DeviceControls").html("<li>Touch on an environment to enter it.</li><li>Touch within an environment to move.</li><li>Touch and drag to rotate camera.</li><li>Zoom in/out with the buttons in the bottom left.</li><li>Exit an environment with the button in the bottom right.</li>"):$(".ARTSTATION_DeviceControls").html("<li><b>Environments</b></li><ul><li>Click to enter from world view.</li><li>Double click to move focus.</li><li>Use left mouse down to rotate camera.</li><li>Zoom in/out with the buttons in the bottom left.</li><li>Exit with the button in the bottom right.</li></ul><li><b>Videos</b></li><ul><li>Click a video marker to play.</li><li>Play/pause with the buttons in the bottom left.</li><li>Exit with the button in the bottom right.</li></ul>"),viewer.scene.getActiveCamera().far=5e9,viewer.setBackground("skybox"),viewer.loadGUI(function(){viewer.setLanguage("en"),$("#menu_appearance").next().show(),$("#menu_tools").next().show()}),$(".ARTSTATION_LoadScreen").fadeIn(1500,function(){var o,n,t,a;o=[],n="http://"+i+"/CONFIGS/regions.json",$.getJSON(n,function(e){$.each(e,function(e,n){o.push(n)})}).done(function(n){o=o[0];for(var t=0;t<o.length;t++)o[t].region_id==e&&c.push(o[t]);c=c[0],$(".ARTSTATION_RegionName").text(c.name),$(".ARTSTATION_RegionDesc").text(c.description),$(".ARTSTATION_RegionTitle").text(c.name)}),t=[],a="http://"+i+"/CONFIGS/locations.json",$.getJSON(a,function(e){$.each(e,function(e,o){t.push(o)})}).done(function(o){t=t[0],f=t.length;for(var n=0;n<t.length;n++)t[n].region==e&&G(t[n],function(e,o){if(e.videos)for(var n=0;n<e.videos.length;n++){var t=e.videos[n].offset;K(o,e.videos[n].filename,e.videos[n].title,t[0],t[1],t[2])}q(o,e.name,e.description,e.key_points),Ee(o),viewer.scene.view.pitch=-.7853981633974672})})}),requestAnimationFrame(function e(o){requestAnimationFrame(e),null==currentDevice&&(currentDevice=new MobileDetect(window.navigator.userAgent)),viewer.update(viewer.clock.getDelta(),o),A!=g&&A!=E||$(".annotation").hide(),viewer.render()}),$(document).on("click",function(e){oe([e.clientX,e.clientY])}),$(document).on("touchstart",function(e){oe([e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY])});var Q=new THREE.Vector2,ee=viewer.getControls(viewer.scene.view.navigationMode);function oe(e){if(A!=I||ee.isTransitioning||(Q.x=e[0],Q.y=e[1],ee.zoomToLocation(Q,!0,1600,!0,function(){Z()}),ee.didClickEnvironment&&($(".annotation").fadeOut(600,function(){$(".annotation").hide()}),pe(S))),A==E&&R){Q.x=e[0]/window.innerWidth*2-1,Q.y=-e[1]/window.innerHeight*2+1;var o=new THREE.Raycaster;o.setFromCamera(Q,viewer.scene.getActiveCamera());for(var n=[],t=0;t<viewer.scene.scene.children.length;t++)"ARTSTATION_VideoMarker"==viewer.scene.scene.children[t].name&&n.push(viewer.scene.scene.children[t]);var i=o.intersectObjects(n),r=null;for(t=0;t<i.length;t++)for(var l=0;l<a.length;l++)a[l].VideoMarker.uuid==i[t].object.uuid&&0==a[l].LockCamera&&(r=l);null!=r&&X(r,!0)}}ee=viewer.getControls(viewer.scene.view.navigationMode);var ne=null;function te(){A==E&&(ne=setInterval(function(){s[0]<=50&&(s[0]++,s[1]--,viewer.getControls(viewer.scene.view.navigationMode).dollyCamera(.4))},50))}var ie=null;function ae(){A==E&&(ie=setInterval(function(){s[1]<=15&&(s[0]--,s[1]++,viewer.getControls(viewer.scene.view.navigationMode).dollyCamera(-.4))},50))}function re(){clearInterval(ne),clearInterval(ie)}var le=null;function ce(){for(var e=0;e<a.length;e++)if(1==a[e].LockCamera){var o=e;le=setInterval(function(){d[0]<=70&&(d[0]++,d[1]--,a[o].VideoCamera.position.z-=.1)},1)}}var se=null;function de(){for(var e=0;e<a.length;e++)if(1==a[e].LockCamera){var o=e;se=setInterval(function(){d[1]<=35&&(d[0]--,d[1]++,a[o].VideoCamera.position.z+=.1)},1)}}function ue(){clearInterval(le),clearInterval(se)}function Te(e,o){e==k||e==V?r[o].MapLoaded[1]=!0:r[o].MapLoaded[0]=!0;for(var n=0,t=0,i=0;i<r.length;i++)for(var a=0;a<r[i].MapLoaded.length;a++)1==r[i].MapLoaded[a]?n++:t++;me(n/(n+t)*100,1)}function me(e,o){p[o]=e/2,w=0;for(var n=0;n<p.length;n++)w+=p[n];$(".ARTSTATION_LoadPercent").text(Math.floor(w)),$(".ARTSTATION_LoadBar").width(w+"%"),100==w&&(fe(I,!1),pe(N),we(!1,!1,500),$("#ARTSTATION_ControlPanel").modal("show"),$(".potree_container").fadeIn(),$(".ARTSTATION_LoadScreen").fadeOut())}function fe(e,n){A!=e&&((A=e)==E?(ve(!1),pe(O)):A==I&&(o=!1,ve(!0),pe(y)),A!=g&&(R=!0))}function ve(e){for(var o=0;o<viewer.scene.measurements.length;o++)viewer.scene.measurements[o].visible=e}function pe(e){e==N?($(".OnlyInEnvironment").hide(),$(".OnlyInVideo").hide(),$(".OnlyInWorldView").show()):e==O?($(".OnlyInEnvironment").fadeIn(500),o||$("#ARTSTATION_ControlPanel").modal("show")):e==M?($(".OnlyInEnvironment").fadeOut(500),o||$("#ARTSTATION_ControlPanel").modal("hide")):e==C?$(".OnlyInVideo").fadeIn(500):e==_?$(".OnlyInVideo").fadeOut(500):e==y?$(".OnlyInWorldView").fadeIn(500):e==S&&$(".OnlyInWorldView").fadeOut(500)}function we(e,o,n){var t=0;e&&(t=1);var i=0;o&&(i=n),e||(R=e);for(var r=0;r<a.length;r++){var l=r,c=new TWEEN.Tween(a[l].VideoMarker.material).to({opacity:t},i);c.onComplete(function(){a[l].VideoMarker.visible=e,R=e}),c.start()}}function he(e){for(var o=0;o<viewer.scene.pointclouds.length;o++)viewer.scene.pointclouds[o].uuid!=h.UUID&&(viewer.scene.pointclouds[o]._visible=e);for(o=0;o<r.length;o++)r[o].Marker!=h.Marker&&(r[o].Marker.visible=e)}function Ie(e,o,n){var t=new THREE.Vector3,i=new THREE.Euler;if(o){var l=ConvertToUTM(a[e].ImportedTrackData[0][0],a[e].ImportedTrackData[0][1]),c=new THREE.Vector3(l[0]+a[e].X_Offset,l[1]+a[e].Y_Offset,parseFloat(a[e].ImportedTrackData[0][3])+r[a[e].LocationDataIndex].Z_Offset-a[e].Z_Offset);a[e].VideoParent.position.x=c.x,a[e].VideoParent.position.y=c.y,a[e].VideoParent.position.z=c.z,a[e].VideoMesh.rotation.x=a[e].ImportedTrackData[0][8]*Math.PI/180,a[e].VideoMesh.rotation.y=0,a[e].VideoMesh.rotation.z=0,a[e].VideoParent.rotation.x=0,a[e].VideoParent.rotation.y=0,a[e].VideoParent.rotation.z=a[e].ImportedTrackData[0][10]*Math.PI/180,(T=new TWEEN.Tween(a[e].VideoMesh.material).to({opacity:1},2e3)).onStart(function(){a[e].VideoMesh.visible=!0}),T.start(),we(!1,!0,1e3);var d=viewer.getControls(viewer.scene.view.navigationMode);d.isTransitioning=!0,a[e].VideoParent.updateMatrixWorld(),a[e].VideoMesh.updateMatrixWorld(),a[e].VideoCamera.updateMatrixWorld(),a[e].VideoCamera.getWorldPosition(t),i.setFromQuaternion(a[e].VideoCamera.getWorldQuaternion()),a[e].TransitionCamera.position.copy(viewer.scene.getActiveCamera().position),a[e].TransitionCamera.rotation.copy(viewer.scene.getActiveCamera().rotation),TRACKING_CAMERA_OBJECT=a[e].TransitionCamera,TRACKING_CAMERA_IS_ENABLED=!0,viewer.scene.view.pitch=-.7853981633974672,viewer.scene.view.radius=u,s=[0,0],viewer.controls.stop(),d.zoomToLocation({x:0,y:0},!1,1e3,!0,function(){},{pointcloud_origin:h.BasePosition,pointcloud_center:h.Position})}else{var T;(T=new TWEEN.Tween(a[e].VideoMesh.material).to({opacity:0},2e3)).onComplete(function(){a[e].VideoMesh.visible=!1}),T.start(),we(!0,!0,1e3),t.copy(viewer.scene.cameraP.position),i.copy(viewer.scene.cameraP.rotation),a[e].VideoParent.updateMatrixWorld(),a[e].VideoMesh.updateMatrixWorld(),a[e].VideoCamera.updateMatrixWorld(),a[e].VideoCamera.getWorldPosition(a[e].TransitionCamera.position),a[e].TransitionCamera.rotation.setFromQuaternion(a[e].VideoCamera.getWorldQuaternion()),TRACKING_CAMERA_OBJECT=a[e].TransitionCamera,TRACKING_CAMERA_IS_ENABLED=!0}var m=new TWEEN.Tween(a[e].TransitionCamera.position).to({x:t.x,y:t.y,z:t.z},2e3),f=new TWEEN.Tween(a[e].TransitionCamera.rotation).to({x:i.x,y:i.y,z:i.z},2e3);m.onStart(function(){pe(o?M:_),f.start()}),m.onComplete(function(){pe(o?C:O),n()}),m.start()}function Ee(e){if(0,e==f-1){var o=[],n="http://"+i+"/CONFIGS/lines.json";$.getJSON(n,function(e){$.each(e,function(e,n){o.push(n)})}).done(function(e){o=o[0];for(var n=0;n<o.length;n++){for(var t=0;t<r.length;t++)r[t].LocationID==o[n].from&&(o[n].from=new THREE.Vector3(r[t].Position.x,r[t].Position.y,5)),r[t].LocationID==o[n].to&&(o[n].to=new THREE.Vector3(r[t].Position.x,r[t].Position.y,5));var i=new Potree.Measure;i.addMarker(o[n].from),i.addMarker(o[n].to);for(t=0;t<i.spheres.length;t++)i.spheres[t].visible=!1;for(t=0;t<i.edgeLabels.length;t++)o[n].text?(i.edgeLabels[t].setText(o[n].text),i.edgeLabels[t].visible=!0):i.edgeLabels[t].visible=!1;i.color={r:0,g:0,b:0},viewer.scene.addMeasurement(i)}})}}function ge(e){for(var o=viewer.getControls(viewer.scene.view.navigationMode),n=0;n<viewer.scene.scene.children.length;n++)if(viewer.scene.scene.children[n].name=="ARTSTATION_EnvViewMap_"+o.clickedEnvironmentUUID){e&&(viewer.scene.scene.children[n].visible=!0);for(var t=0;t<viewer.scene.scene.children[n].children.length;t++)e?new TWEEN.Tween(viewer.scene.scene.children[n].children[t].material).to({opacity:1},500).start():new TWEEN.Tween(viewer.scene.scene.children[n].children[t].material).to({opacity:0},1500).start();e||(viewer.scene.scene.children[n].visible=!1)}else viewer.scene.scene.children[n].name}function Ae(e,o,n,t,i){var a=[];if(n%2!=0||n<2)return a;for(var r,l,c,s,d,u,T,f,v=Math.floor((r=e[0],l=o,(1-Math.log(Math.tan(r*Math.PI/180)+1/Math.cos(r*Math.PI/180))/Math.PI)/2*Math.pow(2,l))),p=Math.floor((c=e[1],s=o,(c+180)/360*Math.pow(2,s))),w=-n/2;w<=n/2;w++)for(var h=-n/2;h<=n/2;h++){for(var I=p+h,E=v+w,g=0;g<m.length;g++)m[g].x!=I||m[g].y;var A=(u=E,T=o,void 0,f=Math.PI-2*Math.PI*u/Math.pow(2,T),180/Math.PI*Math.atan(.5*(Math.exp(f)-Math.exp(-f)))),R=(d=o,I/Math.pow(2,d)*360-180),O=ConvertToUTM(A,R),M=[];for(g=0;g<i[3].length;g++){var C=i[3];M.push(i[0]+C[g]+i[1]+"/"+o+"/"+I+"/"+E+"."+i[2]),0!=t&&M.push(i[0]+C[g]+i[1]+"/"+o+"/"+I+"/"+E+"@"+t+"x."+i[2])}a.push({TileURL:M,TileLat:A,TileLon:R,TileWorldX:O[0],TileWorldY:O[1],TileUrlX:I,TileUrlY:E,TileUrlZ:o}),m.push({x:I,y:E})}return a}function Re(e,o,n,t){var i=new THREE.Group;i.name="ARTSTATION_BespokeMapGroup",".wikimedia.org/osm-intl"!=n[1]&&o==V&&(o=k);var a={14:{size:1530,radius:36,mapOffset:new THREE.Vector3(760,-760,0),quality:D,defaultOpacity:1},16:{size:383,radius:10,mapOffset:new THREE.Vector3(200,-190,30),quality:P,defaultOpacity:0},17:{size:192,radius:10,mapOffset:new THREE.Vector3(100,-100,49),quality:L,defaultOpacity:0},18:{size:96,radius:10,mapOffset:new THREE.Vector3(50,-50,49),quality:L,defaultOpacity:0}};a[o].quality>P&&!U&&(a[o].quality=P),a[o].radius>20&&!U&&(a[o].radius=20),".wikimedia.org/osm-intl"!=n[1]&&(a[o].quality=D);for(var r=Ae(e,o,a[o].radius,a[o].quality,n),l=0,c=0;c<r.length;c++){var s=r[c].TileURL,d=null;(d=(new THREE.TextureLoader).load(s[0],function(e){++l==r.length&&Te(o,t)},void 0,function(e){null!=s[1]?d=(new THREE.TextureLoader).load(s[1],function(e){++l==r.length&&Te(o,t)},void 0,function(e){null!=s[2]?d=(new THREE.TextureLoader).load(s[2],function(e){++l==r.length&&Te(o,t)},void 0,function(e){null!=s[3]?d=(new THREE.TextureLoader).load(s[3],function(e){++l==r.length&&Te(o,t)},void 0,function(e){console.error("ARTSTATION: Map loading error occured. Reloading page to utilise cache."),$(".ARTSTATION_LoadScreen").fadeOut(1e3,function(){location.reload()})}):(console.error("ARTSTATION: Map loading error occured. Reloading page to utilise cache."),$(".ARTSTATION_LoadScreen").fadeOut(1e3,function(){location.reload()}))}):(console.error("ARTSTATION: Map loading error occured. Reloading page to utilise cache."),$(".ARTSTATION_LoadScreen").fadeOut(1e3,function(){location.reload()}))}):(console.error("ARTSTATION: Map loading error occured. Reloading page to utilise cache."),$(".ARTSTATION_LoadScreen").fadeOut(1e3,function(){location.reload()}))})).crossOrigin="anonymous",d.wrapS=THREE.RepeatWrapping,d.wrapT=THREE.RepeatWrapping,d.repeat.set(1,1);var u=new THREE.MeshBasicMaterial({color:16777215,map:d,transparent:!0,opacity:a[o].defaultOpacity,alphaTest:.5}),T=new THREE.PlaneGeometry(a[o].size,a[o].size,1,1),m=new THREE.Mesh(T,u);m.name="ARTSTATION_MapTile",m.position.set(r[c].TileWorldX,r[c].TileWorldY,0),m.material.side=THREE.DoubleSide,i.add(m)}return i.position.x=a[o].mapOffset.x,i.position.y=a[o].mapOffset.y,i.position.z=a[o].mapOffset.z,i}$(".DollyZoomIn").on("touchstart",function(){te()}),$(".DollyZoomIn").on("mousedown",function(){te()}),$(".DollyZoomIn").on("touchend",function(){re()}),$(".DollyZoomIn").on("mouseup",function(){re()}),$(".DollyZoomOut").on("touchstart",function(){ae()}),$(".DollyZoomOut").on("mousedown",function(){ae()}),$(".DollyZoomOut").on("touchend",function(){re()}),$(".DollyZoomOut").on("mouseup",function(){re()}),$(".ARTSTATION_VideoZoomIn").on("touchstart",function(){ce()}),$(".ARTSTATION_VideoZoomIn").on("mousedown",function(){ce()}),$(".ARTSTATION_VideoZoomIn").on("touchend",function(){ue()}),$(".ARTSTATION_VideoZoomIn").on("mouseup",function(){ue()}),$(".ARTSTATION_VideoZoomOut").on("touchstart",function(){de()}),$(".ARTSTATION_VideoZoomOut").on("mousedown",function(){de()}),$(".ARTSTATION_VideoZoomOut").on("touchend",function(){ue()}),$(".ARTSTATION_VideoZoomOut").on("mouseup",function(){ue()}),$(".ARTSTATION_HomeBtn").on("click",function(){pe(M),viewer.scene.view.pitch=-.7853981633974672,viewer.fitToScreen(1,2600),s=[0,0],he(!0),we(!1,!0,500),ge(!1),h=null,fe(I,!0),$(".annotation").fadeIn(600,"swing",function(){ee.worldViewCameraConfig=!0})}),$(".ARTSTATION_ReturnToRegionList").on("click",function(){$("body").fadeOut(500,function(){window.location="/"})}),$(".ARTSTATION_PlayBtn").on("click",function(){!function(){for(var e=0;e<a.length;e++)1==a[e].LockCamera&&X(e,!1)}()}),$(".ARTSTATION_PauseBtn").on("click",function(){!function(){for(var e=0;e<a.length;e++)1==a[e].LockCamera&&(o=e,document.getElementById(a[o].ElementID).pause());var o}()}),$(".ARTSTATION_MaximiseBtn").on("click",function(){!function(){for(var e=0;e<a.length;e++)if(1==a[e].LockCamera){var o=document.getElementById(a[e].ElementID);o.style.display="initial",o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()}}()}),$(".ARTSTATION_ExitBtn").on("click",function(){J()}),$(".ARTSTATION_ClosePopup").on("click",function(){A==E&&(o=!0)}),$(window).resize(function(){for(var e=0;e<a.length;e++)a[e].TransitionCamera.aspect=window.innerWidth/window.innerHeight,a[e].VideoCamera.aspect=window.innerWidth/window.innerHeight})}